<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Management</title>
    <link rel="stylesheet" th:href="@{/Manager/ProductManagement/ProductManagement.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="icon" type="image/png" th:href="@{/Customer/Example/Image/LogoConNai.png}">
</head>
<body class="admin-body">
<nav class="admin-sidebar">
    <div class="sidebar-logo">
        <img th:src="@{/Manager/ProductManagement/Image/LogoConNai.png}" alt="Logo" class="logo-img">
        <h2 class="logo-text">Manager</h2>
    </div>
    <ul>
        <li><a th:href="@{/manager/dashboard}"><i class="fa-solid fa-gauge"></i> Dashboard</a></li>
        <li><a th:href="@{/manager/product-management}"><i class="fa-solid fa-box"></i> Sản phẩm</a></li>
        <li><a th:href="@{/manager/category-management}"><i class="fa-solid fa-list"></i> Danh mục</a></li>
        <li><a th:href="@{/manager/deal-management}"><i class="fa-solid fa-tags"></i> Khuyến mãi</a></li>
        <li><a th:href="@{/manager/review-management}"><i class="fa-solid fa-star"></i> Đánh giá</a></li>
        <li><a th:href="@{/manager/order-management}"><i class="fa-solid fa-receipt"></i> Đơn hàng</a></li>
        <li><a th:href="@{/manager/profile}"><i class="fa-solid fa-user"></i> Hồ sơ</a></li>
    </ul>
</nav>

<div class="admin-content">
    <div class="top-bar">
        <div class="user-menu">
            <div class="user-info">
                <i class="fa-solid fa-user-circle"></i>
                <span th:text="${username != null ? username : 'Manager'}">Manager</span>
                <i class="fa-solid fa-chevron-down"></i>
            </div>
            <ul class="dropdown">
                <li><a th:href="@{/logout}"><i class="fa-solid fa-right-from-bracket"></i> Đăng xuất</a></li>
            </ul>
        </div>
    </div>

    <div class="main-area">
        <h2 class="page-title">QUẢN LÝ SẢN PHẨM</h2>

        <div class="product-header">
            <button class="add-product-btn">
                <i class="fa-solid fa-plus"></i> Thêm sản phẩm mới
            </button>
        </div>

        <div class="product-table-container">
            <table class="product-table">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Ảnh</th>
                    <th>Tên sản phẩm</th>
                    <th>Giá</th>
                    <th>Danh mục</th>
                    <th>Ngày tạo</th>
                    <th>Hành động</th>
                </tr>
                </thead>
                <tbody id="product-list">
                <tr th:each="item : ${items}">
                    <td th:text="${item.itemId}">1</td>
                    <td>
                        <img th:if="${item.images != null and !item.images.isEmpty()}"
                             th:src="@{/api/item-images/blob/{id}(id=${item.images[0].itemImageId})}"
                             class="product-img"
                             alt="Product Image">
                        <img th:unless="${item.images != null and !item.images.isEmpty()}"
                             th:src="@{/Manager/ProductManagement/Image/default.png}"
                             class="product-img"
                             alt="No Image">
                    </td>
                    <td style="text-align:left" th:text="${item.name}">Tên sản phẩm</td>
                    <td th:text="${#numbers.formatDecimal(item.price, 0, 'POINT', 0, 'COMMA')} + ' đ'">129.000 đ</td>
                    <td th:text="${item.category != null ? item.category.name : 'N/A'}">Category</td>
                    <td th:text="${#temporals.format(item.createdAt, 'dd/MM/yyyy')}">01/01/2024</td>
                    <td class="action-buttons">
                        <button class="view-btn" th:onclick="'viewProduct(' + ${item.itemId} + ')'" title="Xem chi tiết">
                            <i class="fa-solid fa-eye"></i>
                        </button>
                        <button class="edit-btn" th:onclick="'editProduct(' + ${item.itemId} + ')'" title="Chỉnh sửa">
                            <i class="fa-solid fa-pen-to-square"></i>
                        </button>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        <div class="modal" id="product-modal">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h2 id="modal-title">Thêm sản phẩm</h2>

                <form id="product-form" enctype="multipart/form-data">
                    <input type="hidden" id="product-id">

                    <label>Tên sản phẩm:</label>
                    <input type="text" id="product-name" required>

                    <label>Mô tả:</label>
                    <textarea id="product-description" rows="3" required></textarea>

                    <label>Màu sắc:</label>
                    <input type="text" id="product-color" required>

                    <label>Thành phần:</label>
                    <input type="text" id="product-ingredient" required>

                    <label>Giá (VNĐ):</label>
                    <input type="number" id="product-price" required>

                    <label>Danh mục:</label>
                    <select id="product-category" required>
                        <option value="">-- Chọn danh mục --</option>
                        <option th:each="cat : ${categories}"
                                th:value="${cat.categoryId}"
                                th:text="${cat.name}">Category</option>
                    </select>

                    <label>Ảnh sản phẩm:</label>
                    <input type="file" id="product-image" accept="image/*">
                    <div id="current-image-preview" style="display:none; margin-top: 10px;">
                        <img id="preview-img" src="" alt="Current Image" style="max-width: 200px; border-radius: 8px;">
                    </div>

                    <button type="submit" class="save-product-btn">Lưu</button>
                </form>
            </div>
        </div>

        <div class="modal" id="view-modal">
            <div class="modal-content modal-view">
                <span class="close-modal" id="close-view-modal">&times;</span>
                <h2 id="view-modal-title">Chi tiết sản phẩm</h2>

                <div class="product-detail">
                    <div class="detail-row">
                        <div class="detail-images">
                            <img id="view-product-image" src="" alt="Product Image" class="detail-main-image">
                        </div>
                        <div class="detail-info">
                            <div class="info-group">
                                <label>ID:</label>
                                <span id="view-product-id">-</span>
                            </div>
                            <div class="info-group">
                                <label>Tên sản phẩm:</label>
                                <span id="view-product-name">-</span>
                            </div>
                            <div class="info-group">
                                <label>Giá:</label>
                                <span id="view-product-price">-</span>
                            </div>
                            <div class="info-group">
                                <label>Danh mục:</label>
                                <span id="view-product-category">-</span>
                            </div>
                            <div class="info-group">
                                <label>Màu sắc:</label>
                                <span id="view-product-color">-</span>
                            </div>
                            <div class="info-group">
                                <label>Thành phần:</label>
                                <span id="view-product-ingredient">-</span>
                            </div>
                            <div class="info-group">
                                <label>Mô tả:</label>
                                <p id="view-product-description">-</p>
                            </div>
                            <div class="info-group">
                                <label>Ngày tạo:</label>
                                <span id="view-product-created">-</span>
                            </div>
                            <div class="info-group">
                                <label>Cập nhật lần cuối:</label>
                                <span id="view-product-updated">-</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script th:src="@{/Manager/ProductManagement/ProductManagement.js}"></script>
</body>
</html>